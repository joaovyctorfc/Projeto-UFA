<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <title>Collecting Data</title>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
          integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2"
          crossorigin="anonymous">
</head>

<body class="container"
      style="margin-top: 50px;
             width: 50%; height: auto; ">

    <h2 class="text-primary"
        style="margin-left: 15px; margin-bottom: 10px;">
              Fa√ßa Upload dos Videos
    </h2>
    <form class="container" id="contactForm">
        <div class="card">
            <div class="card-body">

                <div class="form-group"
                     style="margin-left: 15px;
                            margin-top: 10px;
                            display:none;">
                    <label for="exampleFormControlSelect1">Select Type</label>
                    <select class="form-control" id="types">
                        <option>1</option>
                    </select>
                </div>

                <br>
                Document Upload:
                <br>
                <!-- click here to choose file -->
                <input type="file" name="files[]" id="files">
                <!-- click here to upload file -->
                <input type="hidden"
                       name="url"
                       id="url">
                <button type="button" onclick="uploadimage()">
                    Enviar
                </button>
                <br><br>
            </div>
        </div>

        <button type="submit"
                class="btn btn-primary"
                style="margin-left: 15px; margin-top: 10px; display:none;">
            Submit
        </button>

    </form>

    <script src="https://www.gstatic.com/firebasejs/3.7.4/firebase.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.css" />
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <script>
        var firebaseConfig = {
            apiKey: "AIzaSyCzKJQhamtH0XAJgK1gvGIFlW7MU9ujm48",
            authDomain: "projeto-drone.firebaseapp.com",
            databaseURL: "https://projeto-drone-default-rtdb.firebaseio.com",
            projectId: "projeto-drone",
            storageBucket: "projeto-drone.appspot.com",
            messagingSenderId: "557356924152",
            appId: "1:557356924152:web:2574dec37d71b47cb20f0d",
             measurementId: "G-N41S4N7B8P"
        };
        firebase.initializeApp(firebaseConfig);
        var messagesRef = firebase.database().ref('Checking');

        document.getElementById('contactForm').addEventListener('submit', submitForm);

        function uploadimage(){
            var type = getInputVal('types');
            var storage = firebase.storage();
            var file = document.getElementById("files").files[0];
            var storageref = storage.ref();
            var thisref = storageref.child(type).child(file.name).put(file);
            thisref.on('state_changed',
                function(snapshot) {},
                function(error) {},
                function() {
                    thisref.snapshot.ref.getDownloadURL().then(function(downloadURL) {
                        document.getElementById("url").value = downloadURL;
                        alert('uploaded successfully');
                        saveMessage(downloadURL);
                    });
                });
            var url = getInputVal('url');
        }

        function getInputVal(id) {
            return document.getElementById(id).value;
        }

        function saveMessage(url) {
            var newMessageRef = messagesRef.push();
            newMessageRef.set({
                imageurl: url,
            });
        }
    </script>
</body>

</html>
