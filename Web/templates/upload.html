

</html>
<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <title>Collecting Data</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
</head>
<nav class="navbar navbar-expand-lg bg-body-tertiary">
    <div class="container-fluid">
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="/home">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="/">Sair</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="/Video">Video</a>
                </li>
            </ul>
        </div>
    </div>
</nav>
<body class="container" style="margin-top: 50px; width: 50%; height: auto;">

    <h2 class="text-primary" style="margin-left: 15px; margin-bottom: 10px;">Faça Upload dos Vídeos</h2>
    <form class="container" id="contactForm" enctype="multipart/form-data">
        <div class="card">
            <div class="card-body">
                Document Upload:
                <br>
                <input type="file" name="files[]" id="files">
                <input type="hidden" name="url" id="url">
                <button type="button" onclick="uploadVideo()">
                    Enviar
                </button>
                <br>
                <div id="error-message" style="color: red;"></div>
            </div>
        </div>
    </form>

    <script src="https://www.gstatic.com/firebasejs/3.7.4/firebase.js"></script>
    <script src="https://ajax.googleapis.com/libs/jquery/1.9.1/jquery.min.js"></script>
    <link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.css" />
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <script>
        var firebaseConfig = {
            apiKey: "AIzaSyCzKJQhamtH0XAJgK1gvGIFlW7MU9ujm48",
            authDomain: "projeto-drone.firebaseapp.com",
            databaseURL: "https://projeto-drone-default-rtdb.firebaseio.com",
            projectId: "projeto-drone",
            storageBucket: "projeto-drone.appspot.com",
            messagingSenderId: "557356924152",
            appId: "1:557356924152:web:2574dec37d71b47cb20f0d",
             measurementId: "G-N41S4N7B8P"
        };
        firebase.initializeApp(firebaseConfig);
        var messagesRef = firebase.database().ref('Checking');

        document.getElementById('contactForm').addEventListener('submit', submitForm);

        function uploadVideo() {
            var storage = firebase.storage();
            var fileInput = document.getElementById("files");
            var file = fileInput.files[0];
            
            if (!file) {
                document.getElementById('error-message').innerText = 'Selecione um arquivo.';
                return;
            }

            var fileExt = file.name.split('.').pop().toLowerCase();
            var allowedExts = ['mp4', 'webm', 'avi', 'flv'];

            if (allowedExts.indexOf(fileExt) === -1) {
                document.getElementById('error-message').innerText = 'Selecione um arquivo com extensão .mp4, .webm, .avi ou .flv.';
                return;
            }

            document.getElementById('error-message').innerText = '';
            var storageRef = storage.ref();
            var type = 'your_type_here'; 
            var thisRef = storageRef.child(type).child(file.name);
            
            thisRef.put(file).then(function(snapshot) {
                return thisRef.getDownloadURL();
            }).then(function(downloadURL) {
                document.getElementById("url").value = downloadURL;
                alert('Upload bem-sucedido');
                saveMessage(downloadURL);
            }).catch(function(error) {
                console.error('Erro de upload:', error);
            });
        }

        function getInputVal(id) {
            return document.getElementById(id).value;
        }
        function saveMessage(url) {
    var userEmail = "{{ user_email }}";

    var currentDate = new Date();
var dateFormatted = currentDate.toLocaleString('en-US', {
  year: 'numeric',
  month: '2-digit',
  day: '2-digit',
  hour: '2-digit',
  minute: '2-digit',
  second: '2-digit',
});

var newMessageRef = messagesRef.push();
newMessageRef.set({
  imageurl: url,
  email: userEmail,
  date: dateFormatted
});


        }
    </script>
</body>

</html>